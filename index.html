<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>RGC Scorecard</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#b00020">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Alresford">
<link rel="apple-touch-icon" href="apple-touch-icon.png">

<style>
:root { --club:#b00020; --club2:#bfe8ff; --bg:#eef9ff; --card:#ffffff; --ink:#063047; --muted:#5a7a8a; --line:#d8e7ef; --good:#0b7a3d; --danger:#b00020; }
@media (prefers-color-scheme: dark) { :root { --bg:#071821; --card:#0c2330; --ink:#e9f6ff; --muted:#a6c2d2; --line:#173847; --club:#b00020; --club2:#06202c; } }
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(180deg,var(--club2),var(--bg));color:var(--ink);overflow-y:auto;}
header{position:sticky;top:0;z-index:50;padding:12px 14px 10px 14px;backdrop-filter:blur(10px);background:color-mix(in srgb,var(--club2) 70%,transparent);border-bottom:1px solid color-mix(in srgb,var(--line) 80%,transparent);}
.toprow{display:flex;align-items:center;justify-content:space-between;gap:12px;}
.title{line-height:1.15;}
.title h1{margin:0;font-size:22px;font-weight:900;letter-spacing:.3px;}
.title .sub{font-size:12px;color:var(--muted);}
.dots{margin-top:10px;display:flex;gap:6px;flex-wrap:wrap;}
.dot{width:10px;height:10px;border-radius:999px;background:color-mix(in srgb,var(--line) 75%,transparent);border:1px solid color-mix(in srgb,var(--line) 90%,transparent);}
.dot.on{background:var(--club);border-color:color-mix(in srgb,var(--club) 55%,var(--line));}
.controls{padding:10px 14px 12px 14px;}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.field{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:10px;box-shadow:0 14px 28px rgba(0,0,0,.08);}
label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px;}
input{width:100%;padding:10px 12px;border-radius:14px;border:1px solid var(--line);background:color-mix(in srgb,var(--card) 92%,transparent);color:var(--ink);font-size:14px;}
.bar{display:flex;gap:10px;flex-wrap:wrap;padding:0 14px 12px 14px;}
button{border:0;border-radius:16px;padding:12px 14px;font-weight:850;cursor:pointer;background:var(--club);color:#053449;}
button.secondary{background:color-mix(in srgb,var(--card) 90%,transparent);border:1px solid var(--line);color:var(--ink);font-weight:800;}
button.danger{background:color-mix(in srgb,var(--danger) 12%,var(--card));border:1px solid color-mix(in srgb,var(--danger) 25%,var(--line));color:var(--ink);}
.hint{padding:0 14px 12px 14px;color:var(--muted);font-size:12px;}
.viewport{position:relative;overflow:hidden;margin:0 14px 0 14px;border-radius:20px;background:var(--card);border:1px solid var(--line);box-shadow:0 16px 34px rgba(0,0,0,.10);transition:height .18s ease;}
.track{display:flex;width:100%;will-change:transform;touch-action:pan-y;align-items:flex-start;}
.page{min-width:100%;padding:14px;padding-bottom: calc(var(--lbpad) + env(safe-area-inset-bottom));align-self:flex-start;height:auto;}
.holehead{display:flex;align-items:flex-start;justify-content:space-between;gap:10px;margin-bottom:10px;}
.holehead h2{margin:0;font-size:20px;letter-spacing:.2px;}
.meta{display:flex;gap:10px;flex-wrap:wrap;color:var(--muted);font-size:12px;}
.pill{display:flex;gap:8px;align-items:center;background:color-mix(in srgb,var(--club) 30%,transparent);border:1px solid color-mix(in srgb,var(--club) 35%,var(--line));padding:6px 10px;border-radius:999px;font-weight:850;}
.players{display:grid;grid-template-columns:1fr;gap:10px;margin-top:12px;}
.pcard{border:1px solid var(--line);border-radius:18px;padding:12px;background:color-mix(in srgb,var(--card) 90%,transparent);}
.prow{display:flex;align-items:center;justify-content:space-between;gap:10px;}
.pname{font-weight:950;font-size:14px;display:flex;align-items:center;gap:8px;}
.chip{width:10px;height:10px;border-radius:999px;display:inline-block;}
.scorebox{display:flex;align-items:center;gap:10px;}
.big{font-size:40px;font-weight:950;letter-spacing:-0.5px;min-width:46px;text-align:center;}
.mini{display:flex;flex-direction:column;gap:8px;}
.pm{width:54px;height:48px;border-radius:14px;font-size:22px;font-weight:950;}
.pm.minus{background:color-mix(in srgb,var(--card) 92%,transparent);border:1px solid var(--line);color:var(--ink);}
.badges{margin-top:10px;display:flex;gap:12px;align-items:center;justify-content:space-between;}
.tog{display:flex;gap:8px;align-items:center;font-weight:900;}
.switch{width:52px;height:30px;background:color-mix(in srgb,var(--line) 80%,transparent);border-radius:999px;position:relative;border:1px solid var(--line);}
.knob{width:26px;height:26px;border-radius:50%;background:var(--card);position:absolute;top:1px;left:1px;transition:transform .18s ease;box-shadow:0 6px 14px rgba(0,0,0,.12);}
.switch.on{background:color-mix(in srgb,var(--good) 35%,transparent);border-color:color-mix(in srgb,var(--good) 40%,var(--line));}
.switch.on .knob{transform:translateX(22px);}
.points{font-weight:950;font-size:14px;}
.bbbpill{font-weight:950;font-size:12px;color:var(--muted);margin-top:4px;}
.thumb .scorebox{flex-direction:column-reverse;align-items:flex-end;}
.thumb .mini{flex-direction:row;}
.thumb .pm{width:70px;height:54px;font-size:26px;border-radius:18px;}
.minibar{position:fixed;left:14px;right:14px;bottom:8px;z-index:90;background:color-mix(in srgb,var(--card) 92%,transparent);border:1px solid var(--line);border-radius:18px;box-shadow:0 18px 40px rgba(0,0,0,.18);padding:10px 12px;}
.minibar .top{display:flex;align-items:flex-start;justify-content:space-between;gap:10px;}
.modepill{font-weight:900;font-size:12px;color:var(--muted);}
.holders{font-weight:900;font-size:12px;color:var(--muted);margin-top:2px;line-height:1.25;}
.minirows{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px;}
.minirow{border:1px solid var(--line);border-radius:14px;padding:8px 10px;display:flex;justify-content:space-between;align-items:center;}
.minirow .n{font-weight:950;font-size:12px;}
.minirow .s{font-weight:950;font-size:12px;}
.sheet{position:fixed;left:0;right:0;bottom:-78vh;height:78vh;z-index:120;background:var(--card);border:1px solid var(--line);border-top-left-radius:22px;border-top-right-radius:22px;box-shadow:0 -20px 50px rgba(0,0,0,.22);transition:transform .28s ease;}
.sheet.open{transform:translateY(-78vh);}
.grab{width:44px;height:5px;border-radius:999px;background:color-mix(in srgb,var(--line) 85%,transparent);margin:8px auto 0 auto;}
.sheethead{padding:10px 14px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--line);}
.sheetbody{padding:12px 14px 18px 14px;overflow:auto;height:calc(78vh - 56px);}
.row{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border:1px solid var(--line);border-radius:16px;margin-bottom:10px;background:color-mix(in srgb,var(--card) 92%,transparent);}
.row .name{font-weight:950;}
.row .stat{font-weight:950;}
.row .sub{font-size:12px;color:var(--muted);}
.tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px;}
.tab{padding:8px 10px;border-radius:999px;border:1px solid var(--line);background:color-mix(in srgb,var(--card) 92%,transparent);font-weight:900;font-size:12px;cursor:pointer;}
.tab.on{background:color-mix(in srgb,var(--club) 35%,transparent);border-color:color-mix(in srgb,var(--club) 55%,var(--line));}
.toast{position:fixed;left:50%;bottom:132px;transform:translateX(-50%);padding:10px 12px;background:rgba(6,48,71,.92);color:#fff;border-radius:14px;font-size:12px;display:none;z-index:200;}
.finalcard{border:1px solid var(--line);border-radius:18px;padding:12px;background:color-mix(in srgb,var(--card) 90%,transparent);}

.eliteBadge{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid color-mix(in srgb,var(--club) 55%,var(--line));
  background:color-mix(in srgb,var(--club) 22%,transparent);
  box-shadow:0 10px 26px rgba(127,211,255,.22);
  font-weight:950;
}
.eliteBadge.snake{
  box-shadow:0 0 0 1px color-mix(in srgb,#31d1ff 55%,transparent),
             0 10px 28px rgba(49,209,255,.28),
             0 0 34px rgba(49,209,255,.18);
}
.eliteBadge.camel{
  box-shadow:0 0 0 1px color-mix(in srgb,#ffcc66 50%,transparent),
             0 10px 28px rgba(255,204,102,.26),
             0 0 34px rgba(255,204,102,.16);
}
.creditPip{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  min-width:22px;
  height:22px;
  padding:0 7px;
  border-radius:999px;
  background:color-mix(in srgb,var(--card) 92%,transparent);
  border:1px solid var(--line);
  font-size:12px;
  font-weight:950;
}
@keyframes elitePulse{
  0%{ transform:scale(1); filter:drop-shadow(0 0 0 rgba(127,211,255,.0)); }
  55%{ transform:scale(1.04); filter:drop-shadow(0 0 10px rgba(127,211,255,.25)); }
  100%{ transform:scale(1); filter:drop-shadow(0 0 0 rgba(127,211,255,.0)); }
}
.holderPulse{
  animation: elitePulse .55s ease-out 1;
}
.holderRow{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
}


/* Ultimate polish */
button{position:relative;overflow:hidden;}
button:active{transform:scale(.99);}
.ripple{
  position:absolute;border-radius:999px;transform:scale(0);
  background:rgba(255,255,255,.55);pointer-events:none;
  animation:ripple .55s ease-out;
}
@keyframes ripple{to{transform:scale(18);opacity:0;}}

.minibar{position:fixed;left:14px;right:14px;bottom:8px;z-index:90;background:color-mix(in srgb,var(--card) 92%,transparent);border:1px solid var(--line);border-radius:18px;box-shadow:0 18px 40px rgba(0,0,0,.18);padding:10px 12px;}
.sheet{
  background: color-mix(in srgb,var(--card) 85%,transparent);
  backdrop-filter: blur(18px) saturate(140%);
}
.pcard{transition:transform .12s ease, box-shadow .12s ease;}
.pcard:active{transform:translateY(1px);box-shadow:0 10px 22px rgba(0,0,0,.10);}
.big{transition:transform .14s ease, filter .14s ease;}
.big.pop{transform:scale(1.08);filter:drop-shadow(0 10px 22px rgba(0,0,0,.16));}
/* Better page motion */
.track{transition:transform .18s cubic-bezier(.2,.9,.2,1);}


/* Minibar compact so it never blocks scoring (always visible) */
.minibar{padding:8px 10px;}
.minibar .minirows{gap:6px;margin-top:8px;}
.minirow{padding:7px 9px;}
.minirow .n,.minirow .s{font-size:12px;}
.holders{margin-top:1px;}
html,body{height:100%;}
body{overscroll-behavior-y:none;}
header{padding-top:calc(12px + env(safe-area-inset-top));}
.minibar{padding-bottom:calc(8px + env(safe-area-inset-bottom));}


/* Spacer so page scrolls beyond fixed live leaderboard */



/* ===== RIDICULOUSLY PREMIUM LAYER ===== */

.pcard{
  transition: transform .18s cubic-bezier(.2,.9,.3,1), box-shadow .18s ease;
}
.pcard:active{
  transform: scale(.985) translateY(1px);
  box-shadow:0 6px 18px rgba(0,0,0,.15);
}

/* score pop animation */
.big{
  transition: transform .15s ease, filter .15s ease;
}
.big.pop{
  transform: scale(1.12);
  filter: drop-shadow(0 10px 14px rgba(0,0,0,.25));
}

/* premium glass live bar */
.minibar{
  backdrop-filter: blur(18px) saturate(160%);
  
  
}

/* snake camel transfer glow */
.holderPulse{
  animation: premiumGlow .45s ease-out;
}
@keyframes premiumGlow{
  0%{ transform:scale(1); filter:brightness(1); }
  50%{ transform:scale(1.08); filter:brightness(1.3); }
  100%{ transform:scale(1); filter:brightness(1); }
}


/* PGA broadcast banner */
.pgaBanner{
  position:fixed;
  top:calc(10px + env(safe-area-inset-top));
  left:50%;
  transform:translateX(-50%) translateY(-140%);
  background:color-mix(in srgb,var(--card) 92%,transparent);
  border:1px solid var(--line);
  box-shadow:0 18px 44px rgba(0,0,0,.22);
  padding:10px 14px;
  border-radius:999px;
  font-weight:950;
  z-index:120;
  display:flex;
  gap:10px;
  align-items:center;
  transition:transform .32s cubic-bezier(.2,.9,.2,1), opacity .32s ease;
  opacity:0;
  backdrop-filter: blur(14px) saturate(150%);
}
.pgaBanner.show{ transform:translateX(-50%) translateY(0); opacity:1; }
.pgaBadge{
  display:inline-flex;align-items:center;justify-content:center;
  padding:3px 10px;border-radius:999px;
  background:color-mix(in srgb,var(--club) 26%,transparent);
  border:1px solid color-mix(in srgb,var(--club) 55%, var(--line));
  font-size:12px;font-weight:950;
}


/* Bottom safe scroll padding so Player 4 clears the fixed live leaderboard (small gap only) */
:root{ --lbpad: 0px; }

/* Final polish animations */
.row{ will-change: transform; }
.row.moving{ transition: transform .22s cubic-bezier(.2,.9,.2,1); }
.statusPill{
  display:inline-flex;align-items:center;justify-content:center;
  padding:4px 10px;border-radius:999px;
  border:1px solid var(--line);
  background:color-mix(in srgb,var(--club) 20%,transparent);
  font-weight:950;font-size:12px;
}
.statusPill.pulse{ animation: statusPulse .35s ease-out; }
@keyframes statusPulse{
  0%{ transform:scale(1); filter:brightness(1); }
  55%{ transform:scale(1.08); filter:brightness(1.25); }
  100%{ transform:scale(1); filter:brightness(1); }
}
.sharebtn{
  width:100%;
  border-radius:18px;
  padding:12px 14px;
  font-weight:950;
  background:color-mix(in srgb,var(--club) 22%,transparent);
  border:1px solid color-mix(in srgb,var(--club) 55%, var(--line));
  box-shadow:0 14px 34px rgba(0,0,0,.12);
}

</style>
</head>
<body>
<header>
  <div class="toprow">
    <div class="title">
      <h1>RGC</h1>
      <div class="sub">Ultimate Swipe Scorecard ‚Ä¢ Swedish + BBB ‚Ä¢ üêç üê´ üê¨ holders</div>
    </div>
    <button class="secondary" id="installBtn" style="display:none;">Install</button>
  </div>
  <div class="dots" id="dots"></div>
</header>
<div id="pgaBanner" class="pgaBanner" aria-live="polite"></div>

<section class="controls">
  <div class="grid">
    
    <div class="field">
      <label>Player 1 ‚Ä¢ Handicap</label>
      <input id="n0" placeholder="Name" style="margin-bottom:8px">
      <input id="h0" type="number" min="0" max="54" placeholder="Handicap (course)">
    </div>

    <div class="field">
      <label>Player 2 ‚Ä¢ Handicap</label>
      <input id="n1" placeholder="Name" style="margin-bottom:8px">
      <input id="h1" type="number" min="0" max="54" placeholder="Handicap (course)">
    </div>

    <div class="field">
      <label>Player 3 ‚Ä¢ Handicap</label>
      <input id="n2" placeholder="Name" style="margin-bottom:8px">
      <input id="h2" type="number" min="0" max="54" placeholder="Handicap (course)">
    </div>

    <div class="field">
      <label>Player 4 ‚Ä¢ Handicap</label>
      <input id="n3" placeholder="Name" style="margin-bottom:8px">
      <input id="h3" type="number" min="0" max="54" placeholder="Handicap (course)">
    </div>
  </div>
</section>

<div class="bar">
  <button class="secondary" id="prevBtn">‚¨ÖÔ∏è Prev</button>
  <button class="secondary" id="nextBtn">Next ‚û°Ô∏è</button>
  <button id="lbBtn">Leaderboard</button>
  <button class="secondary" id="settingsBtn">Settings</button>
  <button class="secondary" id="undoBtn">Undo</button>
  <button class="danger" id="resetBtn">Reset</button>
</div>
<div class="hint">
  Swedish = Per-hole multiplied Stableford totals. ‚Ä¢ BBB = tap 0‚Äì3 per player per hole. ‚Ä¢ üêç/üê´ shows *holder only*.
</div>

<div class="viewport" id="viewport"><div class="track" id="track"></div></div>

<div class="minibar" id="minibar">
  <div class="top">
    <div>
      <div style="font-weight:950;">Live leaderboard</div>
      <div class="holders" id="holdersLine"><span class="eliteBadge snake">üêç <span class="name">‚Äî</span> <span class="creditPip">0</span></span> <span class="eliteBadge camel">üê´ <span class="name">‚Äî</span> <span class="creditPip">0</span></span></div>
    </div>
    <div class="modepill" id="modepill"></div>
  </div>
  <div class="minirows" id="minirows"></div>
</div>

<div class="sheet" id="sheet" aria-hidden="true">
  <div class="grab"></div>
  <div class="sheethead"><div style="font-weight:950;">Leaderboard</div><button class="secondary" id="closeSheet">Close</button></div>
  <div class="sheetbody">
    <div class="tabs">
      <div class="tab on" data-tab="stable">Stableford</div>
      <div class="tab" data-tab="swedish">Swedish</div>
      <div class="tab" data-tab="bbb">BBB</div>
      <div class="tab" data-tab="match">Match Play</div>
      <div class="tab" data-tab="ryder">Ryder Cup</div>
      <div class="tab" data-tab="extras">üêç üê´ üê¨</div>
    </div>
    <div id="lb"></div>
  </div>
</div>

<div class="sheet" id="settings" aria-hidden="true">
  <div class="grab"></div>
  <div class="sheethead"><div style="font-weight:950;">Settings</div><button class="secondary" id="closeSettings">Close</button></div>
  <div class="sheetbody">
    <div class="row" data-key="${r.p}">
      <div><div class="name">Scoring mode</div><div class="sub">Minibar + default leaderboard view</div></div>
      <div><select id="modeSel" style="padding:10px 12px;border-radius:14px;border:1px solid var(--line);background:var(--card);color:var(--ink);font-weight:900;">
        <option value="stable">Stableford</option>
        <option value="swedish">Swedish (pairs)</option>
        <option value="bbb">BBB</option>
        <option value="match">Match Play</option>
        <option value="ryder">Ryder Cup</option>
      </select></div>
    </div>
    <div class="row" data-key="${r.p}">
      <div><div class="name">Haptics</div><div class="sub">Vibration on tap (if supported)</div></div>
      <div><select id="hapticsSel" style="padding:10px 12px;border-radius:14px;border:1px solid var(--line);background:var(--card);color:var(--ink);font-weight:900;">
        <option value="on">On</option><option value="off">Off</option>
      </select></div>
    </div>
    <div class="row" data-key="${r.p}">
      <div><div class="name">Thumb mode</div><div class="sub">Bigger +/‚àí buttons for one‚Äëhanded scoring</div></div>
      <div><select id="thumbSel" style="padding:10px 12px;border-radius:14px;border:1px solid var(--line);background:var(--card);color:var(--ink);font-weight:900;">
        <option value="off">Off</option><option value="on">On</option>
      </select></div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>

/* ===== PREMIUM UX ENGINE ===== */

function premiumHaptic(type){
  if(!navigator.vibrate) return;
  if(type==="score") navigator.vibrate(8);
  if(type==="transfer") navigator.vibrate([10,30,10]);
}

function popNumber(el){
  if(!el) return;
  el.classList.remove("pop");
  void el.offsetWidth;
  el.classList.add("pop");
  setTimeout(()=>el.classList.remove("pop"),180);
}

const HOLES = [{"hole": 1, "white": 396, "yellow": 366, "si": 9, "par": 4}, {"hole": 2, "white": 202, "yellow": 185, "si": 5, "par": 3}, {"hole": 3, "white": 421, "yellow": 415, "si": 3, "par": 4}, {"hole": 4, "white": 334, "yellow": 300, "si": 13, "par": 4}, {"hole": 5, "white": 464, "yellow": 445, "si": 1, "par": 4}, {"hole": 6, "white": 184, "yellow": 165, "si": 7, "par": 3}, {"hole": 7, "white": 495, "yellow": 473, "si": 17, "par": 5}, {"hole": 8, "white": 318, "yellow": 310, "si": 15, "par": 4}, {"hole": 9, "white": 340, "yellow": 325, "si": 11, "par": 4}, {"hole": 10, "white": 128, "yellow": 122, "si": 18, "par": 3}, {"hole": 11, "white": 455, "yellow": 445, "si": 2, "par": 4}, {"hole": 12, "white": 440, "yellow": 432, "si": 4, "par": 4}, {"hole": 13, "white": 164, "yellow": 144, "si": 14, "par": 3}, {"hole": 14, "white": 308, "yellow": 292, "si": 16, "par": 4}, {"hole": 15, "white": 320, "yellow": 308, "si": 12, "par": 4}, {"hole": 16, "white": 195, "yellow": 180, "si": 6, "par": 3}, {"hole": 17, "white": 523, "yellow": 515, "si": 8, "par": 5}, {"hole": 18, "white": 344, "yellow": 341, "si": 10, "par": 4}];
const COLORS = ["#7fd3ff", "#9cffb1", "#ffd27f", "#ff7fb3"];
const PLAYERS = 4;
const PAGES = 19;

let state = {
  names:["","","",""],
  hcps:["","","",""],
  scores:Array.from({length:18}, ()=> Array.from({length:PLAYERS}, ()=> null)),
  bbb:Array.from({length:18}, ()=> Array.from({length:PLAYERS}, ()=> 0)),
  snakeWinner:Array.from({length:18}, ()=> null),
  camelWinner:Array.from({length:18}, ()=> null),
  dolphinWinner:Array.from({length:18}, ()=> null),
  idx:0,
  undo:[],
  settings:{ mode:"stable", haptics:"on", thumb:"off" }
};

function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }

// Haptics + click sound
let audioCtx=null;
function clickSound(){
  try {
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type="sine"; o.frequency.value=520; g.gain.value=0.03;
    o.connect(g); g.connect(audioCtx.destination);
    o.start(); setTimeout(()=>o.stop(), 22);
  } catch(e) {}
}
function haptic(ms=14){
  if((state.settings?.haptics||"on")!=="on") return;
  try { if(navigator.vibrate) navigator.vibrate(ms); } catch(e) {}
}

function strokesOnHole(courseHcp, si){
  const h = clamp(parseInt(courseHcp||0), 0, 54);
  const base = Math.floor(h / 18);
  const rem = h % 18;
  const extra = (rem > 0 && si <= rem) ? 1 : 0;
  return base + extra;
}
function stablefordPoints(gross, par, strokes){
  if (gross===null || gross===undefined) return 0;
  const nett = gross - strokes;
  const pts = 2 + (par - nett);
  return clamp(pts, 0, 6);
}

function toast(msg){
  const t=document.getElementById("toast");
  t.textContent=msg; t.style.display="block";
  clearTimeout(window.__toastTimer);
  window.__toastTimer=setTimeout(()=>t.style.display="none", 1600);
}


let _flipPrev = new Map();
function flipAnimate(container){
  if(!container) return;
  const children = Array.from(container.children);
  const first = new Map();
  for(const el of children){
    const key = el.getAttribute("data-key") || "";
    if(!key) continue;
    first.set(key, el.getBoundingClientRect());
  }
  requestAnimationFrame(()=>{
    const last = new Map();
    for(const el of children){
      const key = el.getAttribute("data-key") || "";
      if(!key) continue;
      last.set(key, el.getBoundingClientRect());
    }
    for(const el of children){
      const key = el.getAttribute("data-key") || "";
      if(!key) continue;
      const f = first.get(key), l = last.get(key);
      if(!f || !l) continue;
      const dx = f.left - l.left;
      const dy = f.top - l.top;
      if(Math.abs(dy) > 0.5 || Math.abs(dx) > 0.5){
        el.classList.add("moving");
        el.style.transform = `translate(${dx}px, ${dy}px)`;
        el.getBoundingClientRect();
        el.style.transform = "translate(0px, 0px)";
        setTimeout(()=>{ el.classList.remove("moving"); el.style.transform=""; }, 260);
      }
    }
  });
}

let _lastRyStatus = null;
function pulseIfChanged(){
  const ryMini = document.getElementById("ryStatusMini");
  const ryFinal = document.getElementById("ryStatusFinal");
  const current = (ryMini && ryMini.textContent) ? ryMini.textContent : (ryFinal && ryFinal.textContent ? ryFinal.textContent : null);
  if(current && _lastRyStatus!==null && current !== _lastRyStatus){
    [ryMini, ryFinal].forEach(el=>{
      if(!el) return;
      el.classList.remove("pulse"); void el.offsetWidth; el.classList.add("pulse");
    });
  }
  if(current) _lastRyStatus = current;
}

let bannerTimer=null;
function showPgaBanner(label, msg){
  const el=document.getElementById("pgaBanner");
  if(!el) return;
  el.innerHTML = `<span class="pgaBadge">${label}</span><span>${msg}</span>`;
  el.classList.add("show");
  clearTimeout(bannerTimer);
  bannerTimer=setTimeout(()=>el.classList.remove("show"), 1500);
}

let lastSnakeHolder = null;
let lastCamelHolder = null;

function setHolderBadges(snake, camel){
  const el = document.getElementById("holdersLine");
  if(!el) return;
  // ensure structure
  let snakeEl = el.querySelector(".eliteBadge.snake");
  let camelEl = el.querySelector(".eliteBadge.camel");
  if(!snakeEl || !camelEl){
    el.innerHTML = `<span class="eliteBadge snake">üêç <span class="name">‚Äî</span> <span class="creditPip">0</span></span>
                    <span class="eliteBadge camel">üê´ <span class="name">‚Äî</span> <span class="creditPip">0</span></span>`;
    snakeEl = el.querySelector(".eliteBadge.snake");
    camelEl = el.querySelector(".eliteBadge.camel");
  }

  const snakeName = snake.holder===null ? "‚Äî" : getPName(snake.holder);
  const camelName = camel.holder===null ? "‚Äî" : getPName(camel.holder);
  const snakeCredits = snake.holder===null ? 0 : (snake.credits[snake.holder]||0);
  const camelCredits = camel.holder===null ? 0 : (camel.credits[camel.holder]||0);

  snakeEl.querySelector(".name").textContent = snakeName;
  snakeEl.querySelector(".creditPip").textContent = snakeCredits;
  camelEl.querySelector(".name").textContent = camelName;
  camelEl.querySelector(".creditPip").textContent = camelCredits;

  // animate on holder change
  if(lastSnakeHolder !== snake.holder){
    snakeEl.classList.remove("holderPulse");
    void snakeEl.offsetWidth;
    snakeEl.classList.add("holderPulse");
    haptic(18);
  }
  if(lastCamelHolder !== camel.holder){
    camelEl.classList.remove("holderPulse");
    void camelEl.offsetWidth;
    camelEl.classList.add("holderPulse");
    haptic(18);
  }
  lastSnakeHolder = snake.holder;
  lastCamelHolder = camel.holder;
}


function save(){ localStorage.setItem("rgc_scorecard_v1", JSON.stringify(state)); }
function load(){
  const raw = localStorage.getItem("rgc_scorecard_v1")
    || localStorage.getItem("rgc_scorecard_v1")
    || localStorage.getItem("rgc_scorecard_v1")
    || localStorage.getItem("rgc_scorecard_v1");
  if(!raw) return;
  try {
    const s=JSON.parse(raw);
    if(s && s.scores) {
      if(!s.bbb) s.bbb = Array.from({length:18}, ()=> Array.from({length:PLAYERS}, ()=> 0));
      if(typeof s.idx === "number") s.idx = clamp(s.idx,0,PAGES-1);
      const allowed = new Set(["stable","swedish","bbb","match","ryder"]);
      if(!s.settings) s.settings = {mode:"stable",haptics:"on",thumb:"off"};
      if(!allowed.has(s.settings.mode)) s.settings.mode = "stable";
      state=s;
    }
  } catch(e){}
}

function applySettingsUI(){
  document.getElementById("modeSel").value = state.settings.mode || "stable";
  document.getElementById("hapticsSel").value = state.settings.haptics || "on";
  document.getElementById("thumbSel").value = state.settings.thumb || "off";
  document.body.classList.toggle("thumb", state.settings.thumb==="on");
  document.getElementById("modepill").textContent = {
    stable:"Stableford", swedish:"Swedish (pairs)", bbb:"BBB", match:"Match Play", ryder:"Ryder Cup"
  }[state.settings.mode] || "Stableford";
}
function syncInputs(){
  for(let p=0;p<PLAYERS;p++) {
    document.getElementById("n"+p).value=state.names[p]||"";
    document.getElementById("h"+p).value=state.hcps[p]||"";
  }
}
function getPName(p){ return (state.names[p]||"").trim()? state.names[p].trim() : ("Player "+(p+1)); }

function buildDots(){
  const dots=document.getElementById("dots");
  dots.innerHTML="";
  for(let i=0;i<PAGES;i++) {
    const d=document.createElement("div");
    d.className="dot";
    d.title = (i<18) ? ("Hole "+(i+1)) : "Final";
    d.addEventListener("click", ()=> gotoIdx(i));
    dots.appendChild(d);
  }
}
function updateDots(){ document.querySelectorAll(".dot").forEach((d,i)=> d.classList.toggle("on", i===state.idx)); }

function buildPages(){
  const track=document.getElementById("track");
  track.innerHTML="";
  HOLES.forEach((h,i)=> {
    const page=document.createElement("div");
    page.className="page";
    page.innerHTML = `
      <div class="holehead">
        <div>
          <h2>Hole ${h.hole}</h2>
          <div class="meta">
            <div>Black <b>${h.white}</b></div>
            <div>Purple <b>${h.yellow}</b></div>
            <div>SI <b>${h.si}</b></div>
            <div>Par <b>${h.par}</b></div>
          </div>
        </div>
        <div class="pill">Swipe ‚ü∑</div>
      </div>
      <div class="players" id="players-${i}"></div>
    `;
    track.appendChild(page);
  resizeViewportToActive();
  });
  const final=document.createElement("div");
  final.className="page";
  final.innerHTML = `
    <div class="holehead">
      <div>
        <h2>Final Leaderboard üèÅ</h2>
        <div class="meta">
          <div>Stableford ‚Ä¢ Swedish ‚Ä¢ BBB ‚Ä¢ üêç üê´</div>
        </div>
      </div>
      <div class="pill">Swipe ‚ü∑</div>
    </div>
    <div class="finalcard">
      <div style="font-weight:950;margin-bottom:8px;">Overall results</div>
      <div id="finalSummary" style="color:var(--muted);font-size:12px;margin-bottom:10px;"></div>
      <div class="tabs" style="margin:0 0 10px 0;">
        <div class="tab on" data-ftab="stable">Stableford</div>
        <div class="tab" data-ftab="swedish">Swedish</div>
        <div class="tab" data-ftab="bbb">BBB</div>
        <div class="tab" data-ftab="match">Match Play</div>
        <div class="tab" data-ftab="ryder">Ryder Cup</div>
        <div class="tab" data-ftab="extras">üêç üê´ üê¨</div>
      </div>
      <div id="finalBoard"></div>
      <div style="height:12px;"></div>
      <div id="finalScorecard" class="finalcard"></div>
      <div style="height:10px;"></div>
      <button class="sharebtn" id="shareSummary">Share round summary</button>
    </div>
  `;
  track.appendChild(final);
  final.querySelectorAll('[data-ftab]').forEach(t=>{
    t.addEventListener('click',()=>{
      final.querySelectorAll('[data-ftab]').forEach(x=>x.classList.remove('on'));
      t.classList.add('on');
      clickSound(); haptic(8);
      renderFinal();
    });
  });
  renderAll();
}

function pushUndo(holeIdx,p){
  state.undo.push({
    holeIdx,p,
    prevScore:state.scores[holeIdx][p],
    prevBBB:state.bbb[holeIdx][p],
    prevSnakeWinner: state.snakeWinner[holeIdx],
    prevCamelWinner: state.camelWinner[holeIdx]
  });
  if(state.undo.length>80) state.undo.shift();
}

function bumpStroke(holeIdx,p,delta){
  pushUndo(holeIdx,p);
  const cur=state.scores[holeIdx][p];
  let next = (cur===null) ? 0 : cur;
  next += delta;
  if(next<=0) next=null;
  if(next!==null) next=clamp(next,1,12);
  state.scores[holeIdx][p]=next;
  clickSound(); haptic();
  // PGA hole banner (only when mode uses it)
  if(state.settings.mode==="match"){
    const r = matchPlayHoleWinner(holeIdx);
    if(r.winner!==null) showPgaBanner("MATCH", `${getPName(r.winner)} wins hole ${holeIdx+1}`);
    else if(r.tie) showPgaBanner("MATCH", `Hole ${holeIdx+1} halved`);
  } else if(state.settings.mode==="ryder"){
    const r = ryderCupHoleResult(holeIdx);
    if(r.scored && r.status===1) showPgaBanner("RYDER", `Team A wins hole ${holeIdx+1}`);
    else if(r.scored && r.status===-1) showPgaBanner("RYDER", `Team B wins hole ${holeIdx+1}`);
    else if(r.scored && r.halved) showPgaBanner("RYDER", `Hole ${holeIdx+1} halved`);
  }
  save();
  renderHole(holeIdx);
  requestAnimationFrame(()=>{
    const holder=document.getElementById('players-'+holeIdx);
    const card=holder?.children?.[p];
    const big=card?.querySelector('.big');
    popNumber(big);
    premiumHaptic("score");
  });
  renderLeaderboards();
  renderFinal();
  pulseIfChanged();
  resizeViewportToActive();
}

function bumpBBB(holeIdx,p){
  pushUndo(holeIdx,p);
  const cur = state.bbb[holeIdx][p] || 0;
  const next = (cur + 1) % 4;
  state.bbb[holeIdx][p]=next;
  clickSound(); haptic(10);
  save();
  renderHole(holeIdx);
  requestAnimationFrame(()=>{
    const holder=document.getElementById('players-'+holeIdx);
    const card=holder?.children?.[p];
    const big=card?.querySelector('.big');
    popNumber(big);
    premiumHaptic("score");
  });
  requestAnimationFrame(()=>{
    const holder=document.getElementById("players-"+holeIdx);
    const card=holder?.children?.[p];
    const big=card?.querySelector(".big");
    popNumber(big);
  });
  renderLeaderboards();
  renderFinal();
}

function toggleWinner(kind,holeIdx,p){
  pushUndo(holeIdx,p);
  const arr = (kind==="snake") ? state.snakeWinner : (kind==="camel") ? state.camelWinner : state.dolphinWinner;
  arr[holeIdx] = (arr[holeIdx]===p) ? null : p;
  clickSound(); haptic(10);
  save();
  renderHole(holeIdx);
  requestAnimationFrame(()=>{
    const holder=document.getElementById('players-'+holeIdx);
    const card=holder?.children?.[p];
    const big=card?.querySelector('.big');
    popNumber(big);
    premiumHaptic("score");
  });
  renderLeaderboards();
  renderFinal();
}

function renderPlayerCard(holeIdx,p){
  const h=HOLES[holeIdx];
  const mode = state.settings.mode || "stable";
  const snakeOn = (state.snakeWinner[holeIdx]===p);
  const camelOn = (state.camelWinner[holeIdx]===p);
  const dolphinOn = (state.dolphinWinner[holeIdx]===p);

  const {snake, camel, dolphin} = getExtrasState();
  const isSnakeHolder = (snake.holder===p && (snake.credits[p]||0)>0);
  const isCamelHolder = (camel.holder===p && (camel.credits[p]||0)>0);
  const isDolphinHolder = (dolphin.holder===p && (dolphin.credits[p]||0)>0);

  let extraBits = [];
  if(isSnakeHolder) extraBits.push(`<span class="eliteBadge snake" style="padding:4px 8px;font-size:12px;">üêç <span class="creditPip" style="height:18px;min-width:18px;">${snake.credits[p]||0}</span></span>`);
  if(isCamelHolder) extraBits.push(`<span class="eliteBadge camel" style="padding:4px 8px;font-size:12px;">üê´ <span class="creditPip" style="height:18px;min-width:18px;">${camel.credits[p]||0}</span></span>`);
    if(isDolphinHolder) extraBits.push(`<span class="eliteBadge" style="padding:4px 8px;font-size:12px;background:color-mix(in srgb,var(--club) 18%,transparent);border:1px solid color-mix(in srgb,var(--club) 45%, var(--line));">üê¨ <span class="creditPip" style="height:18px;min-width:18px;">${dolphin.credits[p]||0}</span></span>`);
const extraLine = extraBits.length ? `<div class="holderRow" style="margin-top:6px;">${extraBits.join("")}</div>` : `<div style="height:0;"></div>`;

  const wrap=document.createElement("div");
  wrap.className="pcard";

  if(mode==="bbb") {
    const b = clamp(parseInt(state.bbb[holeIdx][p]||0),0,3);
    wrap.addEventListener("click",(e)=> {
      if(e.target?.classList?.contains("switch")) return;
      bumpBBB(holeIdx,p);
    });
    wrap.innerHTML = `
      <div class="prow">
        <div>
          <div class="pname"><span class="chip" style="background:${COLORS[p]}"></span>${getPName(p)}</div>
          <div class="bbbpill">BBB points (0‚Äì3)</div>
          ${extraLine}
        </div>
        <div class="scorebox">
          <div class="big">${b}</div>
        </div>
      </div>
      <div class="badges">
        <div class="tog">üêç <div class="switch ${snakeOn?"on":""}" data-kind="snake"><div class="knob"></div></div></div>
        <div class="tog">üê´ <div class="switch ${camelOn?"on":""}" data-kind="camel"><div class="knob"></div></div></div>
        <div class="tog">üê¨ <div class="switch ${dolphinOn?"on":""}" data-kind="dolphin"><div class="knob"></div></div></div>
      </div>
    `;
    wrap.querySelectorAll(".switch").forEach(sw=> sw.addEventListener("click",(e)=>{e.stopPropagation();toggleWinner(sw.dataset.kind,holeIdx,p);
    premiumHaptic("transfer");}));
    return wrap;
  }

  const gross=state.scores[holeIdx][p];
  const strokes=strokesOnHole(state.hcps[p], h.si);
  const pts=(gross===null)?0:stablefordPoints(gross,h.par,strokes);
  const scoreText=(gross===null)?"‚Äî":gross;

  wrap.addEventListener("click",(e)=> {
    if(e.target?.classList?.contains("pm")) return;
    if(e.target?.classList?.contains("switch")) return;
    bumpStroke(holeIdx,p,+1);
  });
  wrap.innerHTML = `
    <div class="prow">
      <div>
        <div class="pname"><span class="chip" style="background:${COLORS[p]}"></span>${getPName(p)}</div>
        <div style="font-size:12px;color:var(--muted);">Strokes: ${strokes} ‚Ä¢ Stableford: <span class="points">${pts}</span></div>
        ${extraLine}
      </div>
      <div class="scorebox">
        <div class="mini">
          <button class="pm minus" aria-label="Minus">‚àí</button>
          <button class="pm" aria-label="Plus">+</button>
        </div>
        <div class="big">${scoreText}</div>
      </div>
    </div>
    <div class="badges">
      <div class="tog">üêç <div class="switch ${snakeOn?"on":""}" data-kind="snake"><div class="knob"></div></div></div>
      <div class="tog">üê´ <div class="switch ${camelOn?"on":""}" data-kind="camel"><div class="knob"></div></div></div>
        <div class="tog">üê¨ <div class="switch ${dolphinOn?"on":""}" data-kind="dolphin"><div class="knob"></div></div></div>
    </div>
  `;
  wrap.querySelector(".pm.minus").addEventListener("click",(e)=>{e.stopPropagation();bumpStroke(holeIdx,p,-1);});
  wrap.querySelectorAll(".pm")[1].addEventListener("click",(e)=>{e.stopPropagation();bumpStroke(holeIdx,p,+1);});
  wrap.querySelectorAll(".switch").forEach(sw=> sw.addEventListener("click",(e)=>{e.stopPropagation();toggleWinner(sw.dataset.kind,holeIdx,p);
    premiumHaptic("transfer");}));
  return wrap;
}

function renderHole(holeIdx){
  const holder=document.getElementById("players-"+holeIdx);
  if(!holder) return;
  holder.innerHTML="";
  for(let p=0;p<PLAYERS;p++) holder.appendChild(renderPlayerCard(holeIdx,p));
  resizeViewportToActive();
}
function renderAll(){
  for(let i=0;i<18;i++) renderHole(i);
  updateDots();
  renderLeaderboards();
  renderFinal();
  resizeViewportToActive();
}

// credits + holder (keep logic), but display holder only

function getExtrasState(){
  const snake = computeCreditsAndHolder(state.snakeWinner);
  const camel = computeCreditsAndHolder(state.camelWinner);
  const dolphin = computeCreditsAndHolder(state.dolphinWinner);
  return {snake, camel, dolphin};
}

function computeCreditsAndHolder(winners){
  // New elite logic:
  // - Only the CURRENT holder accumulates credits.
  // - If another player wins, they reduce holder credits by 1.
  // - When holder credits reach 0, new player becomes holder with 1 credit.
  // - Previous holder history is wiped (no carry-over if they regain later).
  let holder = null;
  let holderCredits = 0;

  for(let i=0;i<18;i++){
    const w = winners[i];
    if(w===null || w===undefined) continue;

    if(holder === null){
      holder = w;
      holderCredits = 1;
      continue;
    }

    if(w === holder){
      holderCredits += 1;
      continue;
    }

    // challenger
    holderCredits -= 1;

    if(holderCredits <= 0){
      holder = w;
      holderCredits = 1;
    }
  }

  // build credits array only showing current holder count
  const credits = Array.from({length:PLAYERS}, ()=>0);
  if(holder !== null) credits[holder] = holderCredits;

  return {credits, holder};
}
function holderLabel(emoji, holder, credits){
  if(holder===null) return `${emoji} ‚Äî`;
  const count = credits && credits[holder] ? credits[holder] : 0;
  return `${emoji} ${getPName(holder)} (${count})`;
}

function totalsStablefordPlayers(){
  const rows=[];
  for(let p=0;p<PLAYERS;p++) {
    let gross=0, pts=0;
    for(let i=0;i<18;i++) {
      const h=HOLES[i];
      const sc=state.scores[i][p];
      const s=strokesOnHole(state.hcps[p], h.si);
      const add=(sc===null)?0:stablefordPoints(sc,h.par,s);
      pts += add;
      if(sc!==null) gross += sc;
    }
    rows.push({p,name:getPName(p),pts,gross});
  }
  rows.sort((a,b)=>b.pts-a.pts || a.gross-b.gross);
  return rows;
}

function totalsSwedishPairs(){
  // Swedish (pairs): per-hole multiply of Stableford points, then summed across holes
  let a=0,b=0;
  for(let i=0;i<18;i++){
    const h=HOLES[i];
    const pts = [];
    for(let p=0;p<PLAYERS;p++){
      const sc=state.scores[i][p];
      const s=strokesOnHole(state.hcps[p], h.si);
      pts[p] = (sc===null)?0:stablefordPoints(sc,h.par,s);
    }
    a += (pts[0] * pts[1]);
    b += (pts[2] * pts[3]);
  }
  return {
    nameA: `${getPName(0)} + ${getPName(1)}`,
    nameB: `${getPName(2)} + ${getPName(3)}`,
    ptsA:a, ptsB:b
  };
}

function totalsBBBPlayers(){
  const rows=[];
  for(let p=0;p<PLAYERS;p++) {
    let pts=0;
    for(let i=0;i<18;i++) pts += clamp(parseInt(state.bbb[i][p]||0),0,3);
    rows.push({p,name:getPName(p),pts});
  }
  rows.sort((a,b)=>b.pts-a.pts);
  return rows;
}


function matchPlayHoleWinner(i){
  const h=HOLES[i];
  let bestNet=null;
  let best=[];
  for(let p=0;p<PLAYERS;p++){
    const sc=state.scores[i][p];
    if(sc===null) continue;
    const s=strokesOnHole(state.hcps[p], h.si);
    const net=sc - s;
    if(bestNet===null || net<bestNet){ bestNet=net; best=[p]; }
    else if(net===bestNet){ best.push(p); }
  }
  if(best.length===1) return {winner:best[0], tie:false};
  if(best.length>1) return {winner:null, tie:true};
  return {winner:null, tie:false};
}

function totalsMatchPlay(){
  const wins = Array.from({length:PLAYERS}, ()=>0);
  for(let i=0;i<18;i++){
    const r = matchPlayHoleWinner(i);
    if(r.winner!==null) wins[r.winner] += 1;
  }
  const rows = wins.map((w,p)=>({p,name:getPName(p),wins:w}));
  rows.sort((a,b)=>b.wins-a.wins);
  return rows;
}

function ryderCupHoleResult(i){
  const h=HOLES[i];
  const nets = Array.from({length:PLAYERS}, ()=>null);
  for(let p=0;p<PLAYERS;p++){
    const sc=state.scores[i][p];
    if(sc===null) continue;
    const s=strokesOnHole(state.hcps[p], h.si);
    nets[p] = sc - s;
  }
  const aList = [nets[0], nets[1]].filter(v=>v!==null);
  const bList = [nets[2], nets[3]].filter(v=>v!==null);
  if(aList.length===0 || bList.length===0) return {a:0,b:0,status:0,halved:false,scored:false};
  const aBest = Math.min(...aList);
  const bBest = Math.min(...bList);
  if(aBest < bBest) return {a:1,b:0,status:+1,halved:false,scored:true};
  if(bBest < aBest) return {a:0,b:1,status:-1,halved:false,scored:true};
  return {a:0.5,b:0.5,status:0,halved:true,scored:true};
}

function totalsRyderCup(){
  let ptsA=0, ptsB=0;
  let up=0;
  for(let i=0;i<18;i++){
    const r = ryderCupHoleResult(i);
    ptsA += r.a; ptsB += r.b;
    up += r.status;
  }
  const nameA = `${getPName(0)} + ${getPName(1)}`;
  const nameB = `${getPName(2)} + ${getPName(3)}`;
  const status = (up===0) ? "ALL SQUARE" : (up>0 ? `TEAM A ${up} UP` : `TEAM B ${Math.abs(up)} UP`);
  return {nameA,nameB,ptsA,ptsB,up,status};
}

function renderLeaderboards(){
  const activeTab = document.querySelector(".tab.on")?.dataset?.tab || "stable";
  const stable = totalsStablefordPlayers();
  const sw = totalsSwedishPairs();
  const bbb = totalsBBBPlayers();
  const mp = totalsMatchPlay();
  const ry = totalsRyderCup();

  const snake = computeCreditsAndHolder(state.snakeWinner);
  const camel = computeCreditsAndHolder(state.camelWinner);

  setHolderBadges(snake, camel);

  const mode = state.settings.mode || "stable";
  let miniHtml="";
  if(mode==="swedish") {
    const lead = (sw.ptsA===sw.ptsB) ? "Tied" : (sw.ptsA>sw.ptsB ? "Team A leads" : "Team B leads");
    miniHtml = `
      <div class="minirow" style="grid-column:1 / -1;">
        <div class="n">Swedish (pairs)</div>
        <div class="s">${lead}</div>
      </div>
      <div class="minirow" style="grid-column:1 / -1;">
        <div class="n">${sw.nameA}</div>
        <div class="s">${sw.ptsA} pts</div>
      </div>
      <div class="minirow" style="grid-column:1 / -1;">
        <div class="n">${sw.nameB}</div>
        <div class="s">${sw.ptsB} pts</div>
      </div>
    `;
  } else if(mode==="bbb") {
    miniHtml = bbb.slice(0,4).map(r=>`
      <div class="minirow">
        <div class="n"><span class="chip" style="background:${COLORS[r.p]};margin-right:8px;"></span>${r.name}</div>
        <div class="s">${r.pts} pts</div>
      </div>
    `).join("");
  } else if(mode==="match") {
    miniHtml = mp.map(r=>`
      <div class="minirow">
        <div class="n"><span class="chip" style="background:${COLORS[r.p]};margin-right:8px;"></span>${r.name}</div>
        <div class="s">${r.wins}</div>
      </div>
    `).join("");
  } else if(mode==="ryder") {
    miniHtml = `
      <div class="minirow" style="grid-column:1 / -1;">
        <div class="n">Ryder Cup</div>
        <div class="s"><span class="statusPill" id="ryStatusMini">${ry.status}</span></div>
      </div>
      <div class="minirow" style="grid-column:1 / -1;">
        <div class="n">${ry.nameA}</div>
        <div class="s">${ry.ptsA}</div>
      </div>
      <div class="minirow" style="grid-column:1 / -1;">
        <div class="n">${ry.nameB}</div>
        <div class="s">${ry.ptsB}</div>
      </div>
    `;
  } else {
    miniHtml = stable.slice(0,4).map(r=>`
      <div class="minirow">
        <div class="n"><span class="chip" style="background:${COLORS[r.p]};margin-right:8px;"></span>${r.name}</div>
        <div class="s">${r.pts} pts</div>
      </div>
    `).join("");
  }
  document.getElementById("minirows").innerHTML = miniHtml;

  const lb=document.getElementById("lb");
  if(activeTab==="swedish") {
    const lead = (sw.ptsA===sw.ptsB) ? "All square" : (sw.ptsA>sw.ptsB ? "Team A winning" : "Team B winning");
    lb.innerHTML = `
      <div class="row" data-key="${r.p}">
        <div>
          <div class="name">Swedish (pairs)</div>
          <div class="sub">Per-hole multiplied Stableford totals ‚Ä¢ ${lead}</div>
        </div>
        <div class="stat"></div>
      </div>
      <div class="row" data-key="${r.p}"><div class="name">${sw.nameA}</div><div class="stat">${sw.ptsA} pts</div></div>
      <div class="row" data-key="${r.p}"><div class="name">${sw.nameB}</div><div class="stat">${sw.ptsB} pts</div></div>
    `;
  } else if(activeTab==="bbb") {
    flipAnimate(lb);
    lb.innerHTML = bbb.map((r,idx)=>`
      <div class="row">
        <div><div class="name">${idx+1}. ${r.name}</div><div class="sub">Max 3 per hole ‚Ä¢ tap on hole to cycle 0‚Äì3</div></div>
        <div class="stat">${r.pts} pts</div>
      </div>
    `).join("");
  } else if(activeTab==="match") {
    flipAnimate(lb);
    lb.innerHTML = mp.map((r,idx)=>`
      <div class="row">
        <div><div class="name">${idx+1}. ${r.name}</div><div class="sub">Holes won (net) ‚Ä¢ no early close</div></div>
        <div class="stat">${r.wins}</div>
      </div>
    `).join("");
  } else if(activeTab==="ryder") {
    lb.innerHTML = `
      <div class="row">
        <div>
          <div class="name">Ryder Cup</div>
          <div class="sub">Best net each hole ‚Ä¢ tie = 0.5 ‚Ä¢ <span class="statusPill" id="ryStatusFinal">${ry.status}</span> ‚Ä¢ no early close</div>
        </div>
        <div class="stat"></div>
      </div>
      <div class="row"><div class="name">${ry.nameA}</div><div class="stat">${ry.ptsA}</div></div>
      <div class="row"><div class="name">${ry.nameB}</div><div class="stat">${ry.ptsB}</div></div>
    `;
  } else if(activeTab==="extras") {
    lb.innerHTML = `
      <div class="row">
        <div><div class="name">üêç Snake holder</div><div class="sub">Only shows the current holder</div></div>
        <div class="stat">${snake.holder===null ? "‚Äî" : getPName(snake.holder) + " (" + (snake.credits[snake.holder]||0) + ")"}</div>
      </div>
      <div class="row">
        <div><div class="name">üê´ Camel holder</div><div class="sub">Only shows the current holder</div></div>
        <div class="stat">${camel.holder===null ? "‚Äî" : getPName(camel.holder) + " (" + (camel.credits[camel.holder]||0) + ")"}</div>
      </div>
      <div class="row">
        <div><div class="name">üê¨ Dolphin holder</div><div class="sub">Only shows the current holder</div></div>
        <div class="stat">${dolphin.holder===null ? "‚Äî" : getPName(dolphin.holder) + " (" + (dolphin.credits[dolphin.holder]||0) + ")"}</div>
      </div>
    `;
  } else {
    flipAnimate(lb);
    lb.innerHTML = stable.map((r,idx)=>`
      <div class="row">
        <div>
          <div class="name">${idx+1}. ${r.name}</div>
          <div class="sub">Stableford total ‚Ä¢ Gross ${r.gross||0}</div>
        </div>
        <div class="stat">${r.pts} pts</div>
      </div>
    `).join("");
  }
}


function renderFinalScorecard(){
  const el = document.getElementById("finalScorecard");
  if(!el) return;
  let out = `<div style="font-weight:950;margin-bottom:8px;">Scorecard by hole</div>`;
  for(let p=0;p<PLAYERS;p++){
    out += `<div style="margin-bottom:14px;border:1px solid var(--line);border-radius:16px;padding:10px;background:color-mix(in srgb,var(--card) 92%,transparent);">
      <div style="font-weight:950;margin-bottom:8px;display:flex;align-items:center;justify-content:space-between;">
        <span>${getPName(p)}</span>
        <span style="color:var(--muted);font-size:12px;">Stroke / Stableford</span>
      </div>
      <div style="overflow:auto;">
      <table style="width:100%;border-collapse:collapse;font-size:12px;">
        <thead>
          <tr style="text-align:left;color:var(--muted);">
            <th style="padding:6px 4px;border-bottom:1px solid var(--line);">Hole</th>
            <th style="padding:6px 4px;border-bottom:1px solid var(--line);">Stroke</th>
            <th style="padding:6px 4px;border-bottom:1px solid var(--line);">Stb</th>
          </tr>
        </thead>
        <tbody>`;
    for(let i=0;i<18;i++){
      const h=HOLES[i];
      const sc=state.scores[i][p];
      const s=strokesOnHole(state.hcps[p], h.si);
      const pts=(sc===null)?0:stablefordPoints(sc,h.par,s);
      out += `<tr>
        <td style="padding:6px 4px;border-bottom:1px solid color-mix(in srgb,var(--line) 65%,transparent);">${i+1}</td>
        <td style="padding:6px 4px;border-bottom:1px solid color-mix(in srgb,var(--line) 65%,transparent);">${sc===null?"‚Äî":sc}</td>
        <td style="padding:6px 4px;border-bottom:1px solid color-mix(in srgb,var(--line) 65%,transparent);font-weight:900;">${pts}</td>
      </tr>`;
    }
    out += `</tbody></table></div></div>`;
  }
  el.innerHTML = out;
}

function renderFinal(){
  const finalBoard = document.getElementById("finalBoard");
  if(!finalBoard) return;

  const stable = totalsStablefordPlayers();
  const sw = totalsSwedishPairs();
  const bbb = totalsBBBPlayers();
  const snake = computeCreditsAndHolder(state.snakeWinner);
  const camel = computeCreditsAndHolder(state.camelWinner);

  let doneCount=0;
  for(let i=0;i<18;i++) for(let p=0;p<PLAYERS;p++) if(state.scores[i][p]!==null) doneCount++;
  document.getElementById("finalSummary").textContent = `Stroke scores entered: ${doneCount} / ${18*PLAYERS} ‚Ä¢ BBB points are separate`;

  const tab = document.querySelector('[data-ftab].on')?.dataset?.ftab || "stable";
  if(tab==="swedish") {
    const lead = (sw.ptsA===sw.ptsB) ? "All square" : (sw.ptsA>sw.ptsB ? "Team A winning" : "Team B winning");
    finalBoard.innerHTML = `
      <div class="row">
        <div>
          <div class="name">Swedish (pairs)</div>
          <div class="sub">Per-hole multiplied Stableford totals ‚Ä¢ ${lead}</div>
        </div>
        <div class="stat"></div>
      </div>
      <div class="row"><div class="name">${sw.nameA}</div><div class="stat">${sw.ptsA} pts</div></div>
      <div class="row"><div class="name">${sw.nameB}</div><div class="stat">${sw.ptsB} pts</div></div>
    `;
  } else if(tab==="bbb") {
    finalBoard.innerHTML = bbb.map((r,idx)=>`
      <div class="row">
        <div><div class="name">${idx+1}. ${r.name}</div><div class="sub">Max 3 per hole</div></div>
        <div class="stat">${r.pts} pts</div>
      </div>
    `).join("");
  } else if(tab==="match") {
    finalBoard.innerHTML = mp.map((r,idx)=>`
      <div class="row">
        <div><div class="name">${idx+1}. ${r.name}</div><div class="sub">Holes won (net)</div></div>
        <div class="stat">${r.wins}</div>
      </div>
    `).join("");
  } else if(tab==="ryder") {
    finalBoard.innerHTML = `
      <div class="row">
        <div><div class="name">Ryder Cup</div><div class="sub">Best net each hole ‚Ä¢ tie = 0.5 ‚Ä¢ ${ry.status} ‚Ä¢ no early close</div></div>
        <div class="stat"></div>
      </div>
      <div class="row"><div class="name">${ry.nameA}</div><div class="stat">${ry.ptsA}</div></div>
      <div class="row"><div class="name">${ry.nameB}</div><div class="stat">${ry.ptsB}</div></div>
    `;
  } else if(tab==="extras") {
    finalBoard.innerHTML = `
      <div class="row">
        <div><div class="name">üêç Snake holder</div><div class="sub">Only shows the current holder</div></div>
        <div class="stat">${snake.holder===null ? "‚Äî" : getPName(snake.holder) + " (" + (snake.credits[snake.holder]||0) + ")"}</div>
      </div>
      <div class="row">
        <div><div class="name">üê´ Camel holder</div><div class="sub">Only shows the current holder</div></div>
        <div class="stat">${camel.holder===null ? "‚Äî" : getPName(camel.holder) + " (" + (camel.credits[camel.holder]||0) + ")"}</div>
      </div>
    `;
  } else {
    finalBoard.innerHTML = stable.map((r,idx)=>`
      <div class="row">
        <div><div class="name">${idx+1}. ${r.name}</div><div class="sub">Stableford total ‚Ä¢ Gross ${r.gross||0}</div></div>
        <div class="stat">${r.pts} pts</div>
      </div>
    `).join("");
  }
  renderFinalScorecard();
}

function gotoIdx(i){ state.idx=clamp(i,0,PAGES-1); save(); snapTo(state.idx); resizeViewportToActive(); updateNav(); updateDots(); clickSound(); haptic(8); }
function updateNav(){ document.getElementById("prevBtn").disabled = state.idx===0; document.getElementById("nextBtn").disabled = state.idx===PAGES-1; }

// Swipe
const track=document.getElementById("track");
const viewport=document.getElementById("viewport");
let currentX=0, animFrame=null;
function easeOutCubic(t){ return 1 - Math.pow(1-t,5); }
function animateTo(target, ms){
  if(animFrame) cancelAnimationFrame(animFrame);
  const start=currentX; const t0=performance.now();
  function step(now){
    const t=clamp((now-t0)/ms,0,1);
    currentX = start + (target-start)*easeOutCubic(t);
    track.style.transform = `translate3d(${currentX}px,0,0)`;
    if(t<1) animFrame=requestAnimationFrame(step);
    else { resizeViewportToActive(); }
  }
  animFrame=requestAnimationFrame(step);
}
function snapTo(idx){ resizeViewportToActive(); animateTo(-idx*viewport.clientWidth, 260); }

let dragging=false,startX=0,startY=0,baseX=0,lastX=0,lastT=0,velocity=0;
viewport.addEventListener("pointerdown",(e)=>{ dragging=true; dragStartT=performance.now(); track.style.transition='none'; viewport.setPointerCapture(e.pointerId); startX=e.clientX; startY=e.clientY; baseX=currentX; lastX=e.clientX; lastT=performance.now(); velocity=0; },{passive:true});
viewport.addEventListener("pointermove",(e)=>{
  if(!dragging) return;
  const dx=e.clientX-startX, dy=e.clientY-startY;
  if(Math.abs(dy) > Math.abs(dx)*1.2) return;
  let x=baseX+dx;
  const minX=-(PAGES-1)*viewport.clientWidth, maxX=0;
  if(x>maxX) x = maxX + (x-maxX)*0.25;
  if(x<minX) x = minX + (x-minX)*0.25;
  currentX=x;
  track.style.transform = `translate3d(${currentX}px,0,0)`;
  const now=performance.now();
  velocity=(e.clientX-lastX)/(now-lastT+0.001);
  lastX=e.clientX; lastT=now;
},{passive:true});
function endDrag(){
  if(!dragging) return;
  dragging=false;
  const w=viewport.clientWidth;
  const raw=-currentX/w;
  let idx=Math.round(raw);
  if(Math.abs(velocity)>0.6) idx = velocity<0 ? Math.ceil(raw) : Math.floor(raw);
  idx=clamp(idx,0,PAGES-1);
  state.idx=idx; save();
  track.style.transition='transform .18s cubic-bezier(.2,.9,.2,1)'; snapTo(idx); updateNav(); updateDots();
}
viewport.addEventListener("pointerup", endDrag, {passive:true});
viewport.addEventListener("pointercancel", endDrag, {passive:true});

function openSheet(id, open){ const el=document.getElementById(id); el.classList.toggle("open", open); el.setAttribute("aria-hidden", open ? "false":"true"); clickSound(); haptic(10); }

document.getElementById("prevBtn").addEventListener("click",()=>gotoIdx(state.idx-1));
document.getElementById("nextBtn").addEventListener("click",()=>gotoIdx(state.idx+1));
document.getElementById("lbBtn").addEventListener("click",()=>openSheet("sheet",true));
document.getElementById("closeSheet").addEventListener("click",()=>openSheet("sheet",false));
document.getElementById("minibar").addEventListener("click",()=>openSheet("sheet",true));
document.getElementById("settingsBtn").addEventListener("click",()=>openSheet("settings",true));
document.getElementById("closeSettings").addEventListener("click",()=>openSheet("settings",false));

document.querySelectorAll(".tab").forEach(t=>t.addEventListener("click",()=>{ document.querySelectorAll(".tab").forEach(x=>x.classList.remove("on")); t.classList.add("on"); clickSound(); haptic(8); renderLeaderboards(); }));

document.getElementById("modeSel").addEventListener("change",(e)=>{
  state.settings.mode=e.target.value;
  applySettingsUI();
  const tab = document.querySelector(`.tab[data-tab="${state.settings.mode}"]`);
  if(tab) {
    document.querySelectorAll(".tab").forEach(x=>x.classList.remove("on"));
    tab.classList.add("on");
  }
  save(); clickSound(); haptic(10);
  renderLeaderboards();
  for(let i=0;i<18;i++) renderHole(i);
});
document.getElementById("hapticsSel").addEventListener("change",(e)=>{ state.settings.haptics=e.target.value; save(); clickSound(); haptic(10); toast("Haptics updated"); });
document.getElementById("thumbSel").addEventListener("change",(e)=>{ state.settings.thumb=e.target.value; applySettingsUI(); save(); clickSound(); haptic(10); toast("Thumb mode updated"); });

document.getElementById("undoBtn").addEventListener("click",()=>{
  const u=state.undo.pop();
  if(!u){ toast("Nothing to undo"); clickSound(); haptic(10); return; }
  state.scores[u.holeIdx][u.p]=u.prevScore;
  state.bbb[u.holeIdx][u.p]=u.prevBBB;
  state.snakeWinner[u.holeIdx]=u.prevSnakeWinner;
  state.camelWinner[u.holeIdx]=u.prevCamelWinner;
  save();
  renderHole(u.holeIdx);
  renderLeaderboards();
  renderFinal();
  clickSound(); haptic(14);
  toast("Undone");
});

document.getElementById("resetBtn").addEventListener("click",()=>{
  clickSound(); haptic(12);
  if(!confirm("Reset everything (scores, BBB, üêç, üê´, names)?")) return;

  state.names=["","","",""];
  state.hcps=["","","",""];
  state.scores=Array.from({length:18}, ()=> Array.from({length:PLAYERS}, ()=> null));
  state.bbb=Array.from({length:18}, ()=> Array.from({length:PLAYERS}, ()=> 0));
  state.snakeWinner=Array.from({length:18}, ()=> null);
  state.camelWinner=Array.from({length:18}, ()=> null);
  state.undo=[];
  state.idx=0;
  state.settings.mode = state.settings.mode || "stable"; // keep chosen mode

  save();
  syncInputs();

  // close sheets + go back to hole 1
  openSheet("sheet", false);
  openSheet("settings", false);

  // default leaderboard tab to current mode if available, else Stableford
  const modeTab = document.querySelector(`.tab[data-tab="${state.settings.mode}"]`) || document.querySelector('.tab[data-tab="stable"]');
  if(modeTab){
    document.querySelectorAll(".tab").forEach(x=>x.classList.remove("on"));
    modeTab.classList.add("on");
  }

  renderAll();
  gotoIdx(0);
  toast("Reset complete ‚Ä¢ Ready for next match");
});
for(let p=0;p<PLAYERS;p++) {
  document.getElementById("n"+p).addEventListener("input",(e)=>{ state.names[p]=e.target.value; save(); renderAll(); });
  document.getElementById("h"+p).addEventListener("input",(e)=>{ state.hcps[p]=e.target.value; save(); renderAll(); });
}

let deferredPrompt=null;
window.addEventListener("beforeinstallprompt",(e)=>{ e.preventDefault(); deferredPrompt=e; const b=document.getElementById("installBtn"); b.style.display="inline-flex"; b.onclick=async()=>{ clickSound(); haptic(12); deferredPrompt.prompt(); deferredPrompt=null; b.style.display="none"; }; });


// --- Ultimate UX helpers (ripple, auto-hide minibar, score pop) ---
function addRipple(e){
  const btn = e.currentTarget;
  if(!btn) return;
  const r = document.createElement("span");
  r.className = "ripple";
  const rect = btn.getBoundingClientRect();
  const x = (e.clientX || (rect.left + rect.width/2)) - rect.left;
  const y = (e.clientY || (rect.top + rect.height/2)) - rect.top;
  r.style.left = x + "px";
  r.style.top = y + "px";
  r.style.width = r.style.height = Math.max(rect.width, rect.height) + "px";
  btn.appendChild(r);
  setTimeout(()=>r.remove(), 600);
}
document.querySelectorAll("button").forEach(b=>{
  b.addEventListener("pointerdown", addRipple, {passive:true});
});


function popNumber(el){
  if(!el) return;
  el.classList.remove("pop");
  void el.offsetWidth;
  el.classList.add("pop");
  setTimeout(()=>el.classList.remove("pop"), 170);
}

function isStandalone(){
  return (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) || window.navigator.standalone;
}
function maybeInstallHint(){
  if(isStandalone()) return;
  toast("Tip: Use Install / Add to Home Screen for full app mode");
}
setTimeout(maybeInstallHint, 1400);


load();
buildDots();
syncInputs();
buildPages();
applySettingsUI();
gotoIdx(state.idx||0);
renderLeaderboards();
renderFinal();

if("serviceWorker" in navigator) window.addEventListener("load",()=>navigator.serviceWorker.register("./sw.js").catch(()=>{}));




function resizeViewportToActive(){
  const vp = document.getElementById("viewport");
  const tr = document.getElementById("track");
  if(!vp || !tr) return;
  const idx = state.idx || 0;
  const page = tr.children[idx];
  if(!page) return;
  // Use scrollHeight to include dynamic content
  const h = page.scrollHeight;
  vp.style.height = h + "px";
}

function setLiveBarPad(){
  const lb = document.querySelector(".minibar");
  if(!lb) return;
  const gap = 2; // small visible gap like your screenshot
  const h = lb.offsetHeight || 0;
  document.documentElement.style.setProperty("--lbpad", (h + gap) + "px");
  resizeViewportToActive();
}
window.addEventListener("load", ()=>{ setLiveBarPad(); resizeViewportToActive(); });
window.addEventListener("resize", ()=>{ setLiveBarPad(); resizeViewportToActive(); });
window.addEventListener("orientationchange", setLiveBarPad);


async function shareRoundSummary(){
  try{
    const canvas = document.createElement("canvas");
    const W = 1080, P = 80;
    const lineH = 54;
    const rows = [];
    rows.push(`RGC`);
    rows.push(`Round Summary (${new Date().toLocaleDateString()})`);
    rows.push(`Mode: ${({stable:"Stableford",swedish:"Swedish",bbb:"BBB",match:"Match Play",ryder:"Ryder Cup"}[state.settings.mode]||"Stableford")}`);
    rows.push("");
    const stable = totalsStablefordPlayers();
    rows.push("Stableford:");
    stable.forEach(r=> rows.push(`  ${r.name}: ${r.pts} pts`));
    rows.push("");
    rows.push("Stroke totals:");
    for(let p=0;p<PLAYERS;p++){
      rows.push(`  ${getPName(p)}: ${totalsStroke(p)} strokes`);
    }
    if(state.settings.mode==="match"){
      rows.push("");
      rows.push("Match Play (holes won):");
      totalsMatchPlay().forEach(r=> rows.push(`  ${r.name}: ${r.wins}`));
    }
    if(state.settings.mode==="ryder"){
      const ry = totalsRyderCup();
      rows.push("");
      rows.push(`Ryder Cup: ${ry.status}`);
      rows.push(`  ${ry.nameA}: ${ry.ptsA}`);
      rows.push(`  ${ry.nameB}: ${ry.ptsB}`);
    }
    rows.push("");
    const snake = currentHolder("snake");
    const camel = currentHolder("camel");
    rows.push(`üêç Holder: ${snake.name||"‚Äî"} (${snake.credits||0})`);
    rows.push(`üê´ Holder: ${camel.name||"‚Äî"} (${camel.credits||0})`);
    const dolphin = currentHolder("dolphin");
    rows.push(`üê¨ Holder: ${dolphin.name||"‚Äî"} (${dolphin.credits||0})`);

    const H = P*2 + rows.length*lineH + 120;
    canvas.width = W;
    canvas.height = H;
    const ctx = canvas.getContext("2d");
    ctx.fillStyle = "#0b1620"; ctx.fillRect(0,0,W,H);
    ctx.fillStyle = "#7fd3ff"; ctx.globalAlpha = 0.18; ctx.fillRect(0,0,W,180); ctx.globalAlpha = 1;
    ctx.fillStyle = "#ffffff";
    ctx.font = "900 56px system-ui, -apple-system, Segoe UI, Roboto, Arial";
    ctx.fillText(rows[0], P, 95);
    ctx.font = "650 34px system-ui, -apple-system, Segoe UI, Roboto, Arial";
    ctx.fillStyle = "rgba(255,255,255,.92)";
    ctx.fillText(rows[1], P, 145);

    let y = 220;
    for(let i=2;i<rows.length;i++){
      const t = rows[i];
      if(t===""){ y += lineH*0.55; continue; }
      const isHeader = (!t.startsWith("  ") && t.endsWith(":")) || t.startsWith("Mode:");
      ctx.fillStyle = isHeader ? "rgba(255,255,255,.95)" : "rgba(255,255,255,.85)";
      ctx.font = isHeader ? "800 36px system-ui, -apple-system, Segoe UI, Roboto, Arial" : "600 34px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillText(t, P, y);
      y += lineH;
    }

    const blob = await new Promise(res=>canvas.toBlob(res,"image/png",0.92));
    const file = new File([blob], "alresford-round.png", {type:"image/png"});

    if(navigator.canShare && navigator.canShare({files:[file]})){
      await navigator.share({title:"Alresford Round", text:"Round summary", files:[file]});
    } else {
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "alresford-round.png";
      a.click();
      setTimeout(()=>URL.revokeObjectURL(a.href), 1500);
      toast("Saved summary image");
    }
  } catch(e){
    toast("Share failed");
    console.error(e);
  }
}

function currentHolder(kind){
  const h = state.extras?.holders?.[kind] || {p:null, credits:0};
  const name = (h.p===null || h.p===undefined) ? "" : getPName(h.p);
  return {name, credits: h.credits||0};
}

</script>
</body>
</html>
